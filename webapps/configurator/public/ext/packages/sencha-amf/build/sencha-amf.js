Ext.define("Ext.data.amf.Encoder",{alias:"data.amf.Encoder",config:{format:3,bytes:[]},constructor:function(a){this.initConfig(a);this.clear()},clear:function(){this.setBytes([])},applyFormat:function(b){var a={0:{writeUndefined:this.write0Undefined,writeNull:this.write0Null,writeBoolean:this.write0Boolean,writeNumber:this.write0Number,writeString:this.write0String,writeXml:this.write0Xml,writeDate:this.write0Date,writeArray:this.write0Array,writeGenericObject:this.write0GenericObject},3:{writeUndefined:this.write3Undefined,writeNull:this.write3Null,writeBoolean:this.write3Boolean,writeNumber:this.write3Number,writeString:this.write3String,writeXml:this.write3Xml,writeDate:this.write3Date,writeArray:this.write3Array,writeGenericObject:this.write3GenericObject}}[b];if(a){Ext.apply(this,a);return b}else{return}},writeObject:function(b){var a=typeof(b);if(a==="undefined"){this.writeUndefined()}else{if(b===null){this.writeNull()}else{if(Ext.isBoolean(b)){this.writeBoolean(b)}else{if(Ext.isString(b)){this.writeString(b)}else{if(a==="number"||b instanceof Number){this.writeNumber(b)}else{if(a==="object"){if(b instanceof Date){this.writeDate(b)}else{if(Ext.isArray(b)){this.writeArray(b)}else{if(this.isXmlDocument(b)){this.writeXml(b)}else{this.writeGenericObject(b)}}}}else{}}}}}}},write3Undefined:function(){this.writeByte(0)},write0Undefined:function(){this.writeByte(6)},write3Null:function(){this.writeByte(1)},write0Null:function(){this.writeByte(5)},write3Boolean:function(a){if(a){this.writeByte(3)}else{this.writeByte(2)}},write0Boolean:function(a){this.writeByte(1);if(a){this.writeByte(1)}else{this.writeByte(0)}},encode29Int:function(d){var e=[],a=d,c,b;if(a==0){return[0]}if(a>2097151){c=a&255;e.unshift(c);a=a>>8}while(a>0){c=a&127;e.unshift(c);a=a>>7}for(b=0;b<e.length-1;b++){e[b]=e[b]|128}return e},write3Number:function(c){var d;var a=536870911,b=-268435455;if(c instanceof Number){c=c.valueOf()}if(c%1===0&&c>=b&&c<=a){c=c&a;d=this.encode29Int(c);d.unshift(4);this.writeBytes(d)}else{d=this.encodeDouble(c);d.unshift(5);this.writeBytes(d)}},write0Number:function(a){var b;if(a instanceof Number){a=a.valueOf()}b=this.encodeDouble(a);b.unshift(0);this.writeBytes(b)},encodeUtf8Char:function(h){var f=[],g,a,e,d;if(h<=127){f.push(h)}else{if(h<=2047){a=2}else{if(h<=65535){a=3}else{a=4}}d=128;for(e=1;e<a;e++){g=(h&63)|128;f.unshift(g);h=h>>6;d=(d>>1)|128}g=h|d;f.unshift(g)}return f},encodeUtf8String:function(d){var a,c=[];for(a=0;a<d.length;a++){var b=this.encodeUtf8Char(d.charCodeAt(a));c.push.apply(c,b)}return c},encode3Utf8StringLen:function(c){var a=c.length,b=[];if(a<=268435455){a=a<<1;a=a|1;b=this.encode29Int(a)}else{}return b},write3String:function(b){if(b==""){this.writeByte(6);this.writeByte(1)}else{var c=this.encodeUtf8String(b);var a=this.encode3Utf8StringLen(c);this.writeByte(6);this.writeBytes(a);this.writeBytes(c)}},encodeXInt:function(c,d){var b=[],a;for(a=0;a<d;a++){b.unshift(c&255);c=c>>8}return b},write0String:function(c){if(c==""){this.writeByte(2);this.writeBytes([0,0])}else{var d=this.encodeUtf8String(c);var b;var a;if(d.length<=65535){b=2;a=this.encodeXInt(d.length,2)}else{b=12;a=this.encodeXInt(d.length,4)}this.writeByte(b);this.writeBytes(a);this.writeBytes(d)}},write3XmlWithType:function(c,a){var e=this.convertXmlToString(c);if(e==""){this.writeByte(a);this.writeByte(1)}else{var d=this.encodeUtf8String(e);var b=this.encode3Utf8StringLen(d);this.writeByte(a);this.writeBytes(b);this.writeBytes(d)}},write3XmlDocument:function(a){this.write3XmlWithType(a,7)},write3Xml:function(a){this.write3XmlWithType(a,11)},write0Xml:function(b){var d=this.convertXmlToString(b);this.writeByte(15);var c=this.encodeUtf8String(d);var a=this.encodeXInt(c.length,4);this.writeBytes(a);this.writeBytes(c)},write3Date:function(a){this.writeByte(8);this.writeBytes(this.encode29Int(1));this.writeBytes(this.encodeDouble(new Number(a)))},write0Date:function(a){this.writeByte(11);this.writeBytes(this.encodeDouble(new Number(a)));this.writeBytes([0,0])},write3Array:function(b){this.writeByte(9);var a=b.length;a=a<<1;a=a|1;this.writeBytes(this.encode29Int(a));this.writeByte(1);Ext.each(b,function(c){this.writeObject(c)},this)},write0ObjectProperty:function(b,d){if(!(b instanceof String)&&(typeof(b)!=="string")){b=b+""}var c=this.encodeUtf8String(b);var a;a=this.encodeXInt(c.length,2);this.writeBytes(a);this.writeBytes(c);this.writeObject(d)},write0Array:function(a){var b;this.writeByte(8);var c=0;for(b in a){c++}this.writeBytes(this.encodeXInt(c,4));for(b in a){this.write0ObjectProperty(b,a[b])}this.writeBytes([0,0,9])},write0StrictArray:function(b){this.writeByte(10);var a=b.length;this.writeBytes(this.encodeXInt(a,4));Ext.each(b,function(c){this.writeObject(c)},this)},write3ByteArray:function(b){this.writeByte(12);var a=b.length;a=a<<1;a=a|1;this.writeBytes(this.encode29Int(a));this.writeBytes(b)},write3GenericObject:function(d){var b;this.writeByte(10);var c=11;this.writeByte(c);this.writeByte(1);for(b in d){var a=new String(b).valueOf();if(a==""){}var e=(this.encodeUtf8String(b));this.writeBytes(this.encode3Utf8StringLen(b));this.writeBytes(e);this.writeObject(d[b])}this.writeByte(1)},write0GenericObject:function(d){var c,a,b;c=!!d.$flexType;a=c?16:3;this.writeByte(a);if(c){this.write0ShortUtf8String(d.$flexType)}for(b in d){if(b!="$flexType"){this.write0ObjectProperty(b,d[b])}}this.writeBytes([0,0,9])},writeByte:function(a){this.getBytes().push(a)},writeBytes:function(a){var c;this.getBytes().push.apply(this.getBytes(),a)},convertXmlToString:function(a){var b;if(window.XMLSerializer){b=new window.XMLSerializer().serializeToString(a)}else{b=a.xml}return b},isXmlDocument:function(a){if(window.DOMParser){if(Ext.isDefined(a.doctype)){return true}}if(Ext.isString(a.xml)){return true}return false},encodeDouble:function(o){var b=11,a=52;var g=(1<<(b-1))-1,r,k,h,m,d,q,n,c=[];var j=[127,240,0,0,0,0,0,0],p=[255,240,0,0,0,0,0,0],l=[255,248,0,0,0,0,0,0];if(isNaN(o)){c=l}else{if(o===Infinity){c=j}else{if(o==-Infinity){c=p}else{if(o===0){k=0;h=0;r=(1/o===-Infinity)?1:0}else{r=o<0;o=Math.abs(o);if(o>=Math.pow(2,1-g)){m=Math.min(Math.floor(Math.log(o)/Math.LN2),g);k=m+g;h=Math.round(o*Math.pow(2,a-m)-Math.pow(2,a))}else{k=0;h=Math.round(o/Math.pow(2,1-g-a))}}q=[];for(d=a;d;d-=1){q.push(h%2?1:0);h=Math.floor(h/2)}for(d=b;d;d-=1){q.push(k%2?1:0);k=Math.floor(k/2)}q.push(r?1:0);q.reverse();n=q.join("");c=[];while(n.length){c.push(parseInt(n.substring(0,8),2));n=n.substring(8)}}}}return c},write0ShortUtf8String:function(c){var b=this.encodeUtf8String(c),a;a=this.encodeXInt(b.length,2);this.writeBytes(a);this.writeBytes(b)},writeAmfPacket:function(c,b){var a;this.writeBytes([0,0]);this.writeBytes(this.encodeXInt(c.length,2));for(a in c){this.writeAmfHeader(c[a].name,c[a].mustUnderstand,c[a].value)}this.writeBytes(this.encodeXInt(b.length,2));for(a in b){this.writeAmfMessage(b[a].targetUri,b[a].responseUri,b[a].body)}},writeAmfHeader:function(d,b,c){this.write0ShortUtf8String(d);var a=b?1:0;this.writeByte(a);this.writeBytes(this.encodeXInt(-1,4));this.writeObject(c)},writeAmfMessage:function(c,b,a){this.write0ShortUtf8String(c);this.write0ShortUtf8String(b);this.writeBytes(this.encodeXInt(-1,4));this.write0StrictArray(a)}});Ext.define("Ext.data.amf.Packet",{config:{headers:[],messages:[],version:0},typeMap:{0:{0:"readDouble",1:"readBoolean",2:"readAmf0String",3:"readAmf0Object",5:"readNull",6:"readUndefined",7:"readReference",8:"readEcmaArray",10:"readStrictArray",11:"readAmf0Date",12:"readLongString",13:"readUnsupported",15:"readAmf0Xml",16:"readTypedObject"},3:{0:"readUndefined",1:"readNull",2:"readFalse",3:"readTrue",4:"readUInt29",5:"readDouble",6:"readAmf3String",7:"readAmf3Xml",8:"readAmf3Date",9:"readAmf3Array",10:"readAmf3Object",11:"readAmf3Xml",12:"readByteArray"}},decode:function(b){var e=this,f=[],d=[],c,a;e.twoPowN52=Math.pow(2,-52);e.twoPow8=Math.pow(2,8);e.setHeaders(f);e.setMessages(d);e.pos=0;if(b instanceof ArrayBuffer){b=new Uint8Array(b)}e.bytes=b;e.strings=[];e.objects=[];e.traits=[];e.setVersion(e.readUInt(2));for(c=e.readUInt(2);c--;){e.getHeaders().push({name:e.readAmf0String(),mustUnderstand:e.readBoolean(),byteLength:e.readUInt(4),value:e.readValue()});e.strings=[];e.objects=[];e.traits=[]}for(a=e.readUInt(2);a--;){e.getMessages().push({targetURI:e.readAmf0String(),responseURI:e.readAmf0String(),byteLength:e.readUInt(4),body:e.readValue()});e.strings=[];e.objects=[];e.traits=[]}e.pos=0;e.bytes=e.strings=e.objects=e.traits=null;return e},decodeValue:function(a){var b=this;b.bytes=a;b.pos=0;b.setVersion(3);b.strings=[];b.objects=[];b.traits=[];return b.readValue()},parseXml:function(a){var b;if(window.DOMParser){b=(new DOMParser()).parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(a)}return b},readAmf0Date:function(){var a=new Date(this.readDouble());this.pos+=2;return a},readAmf0Object:function(c){var b=this,a;c=c||{};b.objects.push(c);while((a=b.readAmf0String())||b.bytes[b.pos]!==9){c[a]=b.readValue()}b.pos++;return c},readAmf0String:function(){return this.readUtf8(this.readUInt(2))},readAmf0Xml:function(){return this.parseXml(this.readLongString())},readAmf3Array:function(){var d=this,f=d.readUInt29(),c,b,e,a;if(f&1){c=(f>>1);b=d.readAmf3String();if(b){e={};d.objects.push(e);do{e[b]=d.readValue()}while((b=d.readAmf3String()));for(a=0;a<c;a++){e[a]=d.readValue()}}else{e=[];d.objects.push(e);for(a=0;a<c;a++){e.push(d.readValue())}}}else{e=d.objects[f>>1]}return e},readAmf3Date:function(){var b=this,c=b.readUInt29(),a;if(c&1){a=new Date(b.readDouble());b.objects.push(a)}else{a=b.objects[c>>1]}return a},readAmf3Object:function(){var k=this,f=k.readUInt29(),c=[],m,h,j,b,a,e,l,g,d;if(f&1){m=(f&7);if(m===3){j=k.readAmf3String();b=!!(f&8);h=(f>>4);for(d=0;d<h;d++){c.push(k.readAmf3String())}a={className:j,dynamic:b,members:c};k.traits.push(a)}else{if((f&3)===1){a=k.traits[f>>2];j=a.className;b=a.dynamic;c=a.members;h=c.length}else{if(m===7){}}}if(j){g=Ext.ClassManager.getByAlias("amf."+j);e=g?new g():{$className:j}}else{e={}}k.objects.push(e);for(d=0;d<h;d++){e[c[d]]=k.readValue()}if(b){while((l=k.readAmf3String())){e[l]=k.readValue()}}if((!g)&&this.converters[j]){e=this.converters[j](e)}}else{e=k.objects[f>>1]}return e},readAmf3String:function(){var a=this,c=a.readUInt29(),b;if(c&1){b=a.readUtf8(c>>1);if(b){a.strings.push(b)}return b}else{return a.strings[c>>1]}},readAmf3Xml:function(){var a=this,c=a.readUInt29(),b;if(c&1){b=a.parseXml(a.readUtf8(c>>1));a.objects.push(b)}else{b=a.objects[c>>1]}return b},readBoolean:function(){return !!this.bytes[this.pos++]},readByteArray:function(){var c=this.readUInt29(),b,a;if(c&1){a=this.pos+(c>>1);b=Array.prototype.slice.call(this.bytes,this.pos,a);this.objects.push(b);this.pos=a}else{b=this.objects[c>>1]}return b},readDouble:function(){var d=this.bytes[this.pos++],a=this.bytes[this.pos++],c=(d>>7)?-1:1,g=(((d&127)<<4)|(a>>4)),b=(a&15),e=g?1:0,f=6;while(f--){b=(b*this.twoPow8)+this.bytes[this.pos++]}if(!g){if(!b){return 0}g=1}if(g===2047){return b?NaN:(Infinity*c)}return c*Math.pow(2,g-1023)*(e+this.twoPowN52*b)},readEcmaArray:function(){this.pos+=4;return this.readAmf0Object()},readFalse:function(){return false},readLongString:function(){return this.readUtf8(this.readUInt(4))},readNull:function(){return null},readReference:function(){return this.objects[this.readUInt(2)]},readStrictArray:function(){var c=this,b=c.readUInt(4),a=[];c.objects.push(a);while(b--){a.push(c.readValue())}return a},readTrue:function(){return true},readTypedObject:function(){var e=this,d=e.readAmf0String(),b,a,c;b=Ext.ClassManager.getByAlias("amf."+d);a=b?new b():{$className:d};c=e.readAmf0Object(a);if((!b)&&this.converters[d]){c=this.converters[d](a)}return c},readUInt:function(c){var b=1,a;a=this.bytes[this.pos++];for(;b<c;++b){a=(a<<8)|this.bytes[this.pos++]}return a},readUInt29:function(){var b=this.bytes[this.pos++],a;if(b&128){a=this.bytes[this.pos++];b=((b&127)<<7)|(a&127);if(a&128){a=this.bytes[this.pos++];b=(b<<7)|(a&127);if(a&128){a=this.bytes[this.pos++];b=(b<<8)|a}}}return b},readUndefined:Ext.emptyFn,readUnsupported:Ext.emptyFn,readUtf8:function(k){var d=this.pos+k,g=[],b=0,h=65535,c=1,l=[],f=0,e,a,j;e=[g];while(this.pos<d){j=this.bytes[this.pos++];if(j>127){if(j>239){a=4;j=(j&7)}else{if(j>223){a=3;j=(j&15)}else{a=2;j=(j&31)}}while(--a){j=((j<<6)|(this.bytes[this.pos++]&63))}}g.push(j);if(++b===h){e.push(g=[]);b=0;c++}}for(;f<c;f++){l.push(String.fromCharCode.apply(String,e[f]))}return l.join("")},readValue:function(){var b=this,a=b.bytes[b.pos++];if(a===17){b.setVersion(3);a=b.bytes[b.pos++]}return b[b.typeMap[b.getVersion()][a]]()},converters:{"flex.messaging.io.ArrayCollection":function(a){return a.source||[]}}});Ext.define("Ext.data.amf.RemotingMessage",{alias:"data.amf.remotingmessage",config:{$flexType:"flex.messaging.messages.RemotingMessage",body:[],clientId:"",destination:"",headers:[],messageId:"",operation:"",source:"",timestamp:[],timeToLive:[]},constructor:function(a){this.initConfig(a)},encodeMessage:function(){var a=Ext.create("Ext.data.amf.XmlEncoder"),b;b=Ext.copyTo({},this.getCurrentConfig(),"$flexType,body,clientId,destination,headers,messageId,operation,source,timestamp,timeToLive",true);a.writeObject(b);return a.getBody()}});Ext.define("Ext.data.amf.XmlDecoder",{alias:"data.amf.xmldecoder",statics:{readXml:function(a){var b;if(window.DOMParser){b=(new DOMParser()).parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(a)}return b},readByteArray:function(d){var a=[],f,b,e;e=d.firstChild.nodeValue;for(b=0;b<e.length;b=b+2){f=e.substr(b,2);a.push(parseInt(f,16))}return a},readAMF3Value:function(a){var b;b=Ext.create("Ext.data.amf.Packet");return b.decodeValue(a)},decodeTidFromFlexUID:function(a){var b;b=a.substr(0,8);return parseInt(b,16)}},constructor:function(a){this.initConfig(a);this.clear()},clear:function(){this.objectReferences=[];this.traitsReferences=[];this.stringReferences=[]},readAmfxMessage:function(b){var e,d,a,c,f={};this.clear();e=Ext.data.amf.XmlDecoder.readXml(b);d=e.getElementsByTagName("amfx")[0];a=d.getElementsByTagName("body")[0];f.targetURI=a.getAttribute("targetURI");f.responseURI=a.getAttribute("responseURI");for(c=0;c<a.childNodes.length;c++){if(a.childNodes.item(c).nodeType!=1){continue}f.message=this.readValue(a.childNodes.item(c));break}return f},readValue:function(a){var b;if(typeof a.normalize==="function"){a.normalize()}if(a.tagName=="null"){return null}else{if(a.tagName=="true"){return true}else{if(a.tagName=="false"){return false}else{if(a.tagName=="string"){return this.readString(a)}else{if(a.tagName=="int"){return parseInt(a.firstChild.nodeValue)}else{if(a.tagName=="double"){return parseFloat(a.firstChild.nodeValue)}else{if(a.tagName=="date"){b=new Date(parseFloat(a.firstChild.nodeValue));this.objectReferences.push(b);return b}else{if(a.tagName=="dictionary"){return this.readDictionary(a)}else{if(a.tagName=="array"){return this.readArray(a)}else{if(a.tagName=="ref"){return this.readObjectRef(a)}else{if(a.tagName=="object"){return this.readObject(a)}else{if(a.tagName=="xml"){return Ext.data.amf.XmlDecoder.readXml(a.firstChild.nodeValue)}else{if(a.tagName=="bytearray"){return Ext.data.amf.XmlDecoder.readAMF3Value(Ext.data.amf.XmlDecoder.readByteArray(a))}}}}}}}}}}}}}return null},readString:function(a){var b;if(a.getAttributeNode("id")){return this.stringReferences[parseInt(a.getAttribute("id"))]}b=(a.firstChild?a.firstChild.nodeValue:"")||"";this.stringReferences.push(b);return b},readTraits:function(b){var c=[],a,d;if(b===null){return null}if(b.getAttribute("externalizable")=="true"){return null}if(b.getAttributeNode("id")){return this.traitsReferences[parseInt(b.getAttributeNode("id").value)]}d=b.childNodes;for(a=0;a<d.length;a++){if(d.item(a).nodeType!=1){continue}c.push(this.readValue(d.item(a)))}this.traitsReferences.push(c);return c},readObjectRef:function(a){var b;b=parseInt(a.getAttribute("id"));return this.objectReferences[b]},readObject:function(c){var e,l=[],k,f,d,b,m,a,g=null,h;h=c.getAttribute("type");if(h){g=Ext.ClassManager.getByAlias("amfx."+h)}e=g?new g():(h?{$className:h}:{});if((!g)&&this.converters[h]){e=this.converters[h](this,c);return e}k=c.getElementsByTagName("traits")[0];l=this.readTraits(k);this.objectReferences.push(e);d=0;for(f=0;f<c.childNodes.length;f++){b=c.childNodes.item(f);if(b.nodeType!=1){continue}if(b.tagName=="traits"){continue}m=l[d];a=this.readValue(b);d=d+1;e[m]=a}return e},readArray:function(e){var k=[],c,h,g,f,a,d,m,b,o;this.objectReferences.push(k);m=parseInt(e.getAttributeNode("length").value);h=0;for(f=0;f<e.childNodes.length;f++){c=e.childNodes.item(f);if(c.nodeType!=1){continue}if(c.tagName=="item"){a=c.getAttributeNode("name").value;b=c.childNodes;for(g=0;g<b.length;g++){o=b.item(g);if(o.nodeType!=1){continue}d=this.readValue(o);break}k[a]=d}else{k[h]=this.readValue(c);h++}}return k},readDictionary:function(e){var h={},d,f,c,b,g,a;a=parseInt(e.getAttribute("length"));this.objectReferences.push(h);d=null;f=null;b=0;for(c=0;c<e.childNodes.length;c++){g=e.childNodes.item(c);if(g.nodeType!=1){continue}if(!d){d=this.readValue(g);continue}f=this.readValue(g);b=b+1;h[d]=f;d=null;f=null}return h},convertObjectWithSourceField:function(b){var a,d,c;for(a=0;a<b.childNodes.length;a++){d=b.childNodes.item(a);if(d.tagName=="bytearray"){c=this.readValue(d);this.objectReferences.push(c);return c}}return null},converters:{"flex.messaging.io.ArrayCollection":function(b,a){return b.convertObjectWithSourceField(a)},"mx.collections.ArrayList":function(b,a){return b.convertObjectWithSourceField(a)},"mx.collections.ArrayCollection":function(b,a){return b.convertObjectWithSourceField(a)}}});Ext.define("Ext.data.amf.XmlEncoder",{alias:"data.amf.xmlencoder",config:{body:""},statics:{generateFlexUID:function(e){var d="",c,a,b;if(e===undefined){e=this.randomInt(0,4294967295)}b=(e+4294967296).toString(16).toUpperCase();d=b.substr(b.length-8,8);for(a=0;a<3;a++){d+="-";for(c=0;c<4;c++){d+=this.randomInt(0,15).toString(16).toUpperCase()}}d+="-";b=new Number(new Date()).valueOf().toString(16).toUpperCase();a=0;if(b.length<8){for(c=0;c<b.length-8;c++){a++;d+="0"}}d+=b.substr(-(8-a));for(c=0;c<4;c++){d+=this.randomInt(0,15).toString(16).toUpperCase()}return d},randomInt:function(b,a){return Math.floor(Math.random()*(a-b+1)+b)}},constructor:function(a){this.initConfig(a);this.clear()},clear:function(){this.setBody("")},encodeUndefined:function(){return this.encodeNull()},writeUndefined:function(){this.write(this.encodeUndefined())},encodeNull:function(){return"<null />"},writeNull:function(){this.write(this.encodeNull())},encodeBoolean:function(b){var a;if(b){a="<true />"}else{a="<false />"}return a},writeBoolean:function(a){this.write(this.encodeBoolean(a))},encodeString:function(b){var a;if(b===""){a="<string />"}else{a="<string>"+b+"</string>"}return a},writeString:function(a){this.write(this.encodeString(a))},encodeInt:function(a){return"<int>"+a.toString()+"</int>"},writeInt:function(a){this.write(this.encodeInt(a))},encodeDouble:function(a){return"<double>"+a.toString()+"</double>"},writeDouble:function(a){this.write(this.encodeDouble(a))},encodeNumber:function(b){var a=536870911,c=-268435455;if(b instanceof Number){b=b.valueOf()}if(b%1===0&&b>=c&&b<=a){return this.encodeInt(b)}else{return this.encodeDouble(b)}},writeNumber:function(a){this.write(this.encodeNumber(a))},encodeDate:function(a){return"<date>"+(new Number(a)).toString()+"</date>"},writeDate:function(a){this.write(this.encodeDate(a))},encodeEcmaElement:function(a,b){var c='<item name="'+a.toString()+'">'+this.encodeObject(b)+"</item>";return c},encodeArray:function(g){var e=[],a,d=[],c=g.length,b,f;for(b in g){if(Ext.isNumeric(b)&&(b%1==0)){e[b]=this.encodeObject(g[b])}else{d.push(this.encodeEcmaElement(b,g[b]))}}a=e.length;for(b=0;b<e.length;b++){if(e[b]===undefined){a=b;break}}if(a<e.length){for(b=firstNonOrdinals;b<e.length;b++){if(e[b]!==undefined){d.push(this.encodeEcmaElement(b,e[b]))}}e=e.slice(0,a)}f='<array length="'+e.length+'"';if(d.length>0){f+=' ecma="true"'}f+=">";for(b=0;b<e.length;b++){f+=e[b]}for(b in d){f+=d[b]}f+="</array>";return f},writeArray:function(a){this.write(this.encodeArray(a))},encodeXml:function(a){var b=this.convertXmlToString(a);return"<xml><![CDATA["+b+"]]></xml>"},writeXml:function(a){this.write(this.encodeXml(a))},encodeGenericObject:function(d){var c=[],a=[],f=null,b,e;for(b in d){if(b=="$flexType"){f=d[b]}else{c.push(this.encodeString(new String(b)));a.push(this.encodeObject(d[b]))}}if(f){e='<object type="'+f+'">'}else{e="<object>"}if(c.length>0){e+="<traits>";e+=c.join("");e+="</traits>"}else{e+="<traits />"}e+=a.join("");e+="</object>";return e},writeGenericObject:function(a){this.write(this.encodeGenericObject(a))},encodeByteArray:function(d){var c,a,b;if(d.length>0){c="<bytearray>";for(a=0;a<d.length;a++){b=d[a].toString(16).toUpperCase();if(d[a]<16){b="0"+b}c+=b}c+="</bytearray>"}else{c="<bytearray />"}return c},writeByteArray:function(a){this.write(this.encodeByteArray(a))},encodeObject:function(b){var a=typeof(b);if(a==="undefined"){return this.encodeUndefined()}else{if(b===null){return this.encodeNull()}else{if(Ext.isBoolean(b)){return this.encodeBoolean(b)}else{if(Ext.isString(b)){return this.encodeString(b)}else{if(a==="number"||b instanceof Number){return this.encodeNumber(b)}else{if(a==="object"){if(b instanceof Date){return this.encodeDate(b)}else{if(Ext.isArray(b)){return this.encodeArray(b)}else{if(this.isXmlDocument(b)){return this.encodeXml(b)}else{return this.encodeGenericObject(b)}}}}else{}}}}}}return null},writeObject:function(a){this.write(this.encodeObject(a))},encodeAmfxRemotingPacket:function(a){var c,b;b='<amfx ver="3" xmlns="http://www.macromedia.com/2005/amfx"><body>';b+=a.encodeMessage();b+="</body></amfx>";return b},writeAmfxRemotingPacket:function(a){this.write(this.encodeAmfxRemotingPacket(a))},convertXmlToString:function(a){var b;if(window.XMLSerializer){b=new window.XMLSerializer().serializeToString(a)}else{b=a.xml}return b},isXmlDocument:function(a){if(window.DOMParser){if(Ext.isDefined(a.doctype)){return true}}if(Ext.isString(a.xml)){return true}return false},write:function(a){this.setBody(this.getBody()+a)}});Ext.define("Ext.direct.AmfRemotingProvider",{alias:"direct.amfremotingprovider",extend:Ext.direct.JsonProvider,config:{namespace:undefined,url:null,endpoint:null,enableUrlEncode:null,binary:false,enableBuffer:10,maxRetries:1,timeout:undefined,actions:{},clientId:null,DSId:null},constructor:function(a){var b=this;b.callParent(arguments);b.transactions=Ext.create("Ext.util.Collection",function(c){return c.getId()});b.callBuffer=[]},applyNamespace:function(a){if(Ext.isString(a)){return Ext.ns(a)}return a||window},initAPI:function(){var g=this.getActions(),d=this.getNamespace(),f,a,b,c,e,h;for(f in g){if(g.hasOwnProperty(f)){a=d[f];if(!a){a=d[f]={}}b=g[f];for(c=0,e=b.length;c<e;++c){h=Ext.create("Ext.direct.RemotingMethod",b[c]);a[h.getName()]=this.createHandler(f,h)}}}},createHandler:function(c,d){var b=this,a;if(!d.getFormHandler()){a=function(){b.configureRequest(c,d,Array.prototype.slice.call(arguments,0))}}else{a=function(f,g,e){b.configureFormRequest(c,d,f,g,e)}}a.directCfg={action:c,method:d};return a},isConnected:function(){return !!this.connected},connect:function(){var a=this;if(a.getUrl()){a.setClientId(Ext.data.amf.XmlEncoder.generateFlexUID());a.initAPI();a.connected=true;a.fireEvent("connect",a);a.setDSId(null)}else{}},disconnect:function(){var a=this;if(a.connected){a.connected=false;a.fireEvent("disconnect",a)}},runCallback:function(e,b){var d=!!b.getStatus(),c=d?"success":"failure",f=e&&e.getCallback(),a;if(f){a=b.getResult();if(Ext.isFunction(f)){f(a,b,d)}else{Ext.callback(f[c],f.scope,[a,b,d]);Ext.callback(f.callback,f.scope,[a,b,d])}}},onData:function(k,h,c){var f=this,d=0,e,j,a,b,g;if(h){j=f.createEvents(c);for(e=j.length;d<e;++d){a=j[d];b=f.getTransaction(a);f.fireEvent("data",f,a);if(b){f.runCallback(b,a,true);Ext.direct.Manager.removeTransaction(b)}}}else{g=[].concat(k.transaction);for(e=g.length;d<e;++d){b=f.getTransaction(g[d]);if(b&&b.getRetryCount()<f.getMaxRetries()){b.retry()}else{a=Ext.create("Ext.direct.ExceptionEvent",{data:null,transaction:b,code:Ext.direct.Manager.exceptions.TRANSPORT,message:"Unable to connect to the server.",xhr:c});f.fireEvent("data",f,a);if(b){f.runCallback(b,a,false);Ext.direct.Manager.removeTransaction(b)}}}}},getTransaction:function(a){return a&&a.getTid?Ext.direct.Manager.getTransaction(a.getTid()):null},configureRequest:function(d,a,f){var g=this,c=a.getCallData(f),e=c.data,h=c.callback,i=c.scope,b;b=Ext.create("Ext.direct.Transaction",{provider:g,args:f,action:d,method:a.getName(),data:e,callback:i&&Ext.isFunction(h)?Ext.Function.bind(h,i):h});if(g.fireEvent("beforecall",g,b,a)!==false){Ext.direct.Manager.addTransaction(b);g.queueTransaction(b);g.fireEvent("call",g,b,a)}},getCallData:function(a){if(this.getBinary()){return{targetUri:a.getAction()+"."+a.getMethod(),responseUri:"/"+a.getId(),body:a.getData()||[]}}else{return new Ext.data.amf.RemotingMessage({body:a.data||[],clientId:this.getClientId(),destination:a.getAction(),headers:{DSEndpoint:this.getEndpoint(),DSId:this.getDSId()||"nil"},messageId:Ext.data.amf.XmlEncoder.generateFlexUID(a.getId()),operation:a.getMethod(),timestamp:0,timeToLive:0})}},sendRequest:function(d){var k=this,c={url:k.getUrl(),callback:k.onData,scope:k,transaction:d,timeout:k.getTimeout()},a,l=k.getEnableUrlEncode(),e=0,h,b,j,g=[],f=[];if(Ext.isArray(d)){for(e=0,h=d.length;e<h;++e){g.push(k.getCallData(d[e]))}}else{g.push(k.getCallData(d))}if(k.getBinary()){j=new Ext.data.amf.Encoder({format:0});j.writeAmfPacket(f,g);c.binaryData=j.getBytes();c.binary=true;c.headers={"Content-Type":"application/x-amf"}}else{j=new Ext.data.amf.XmlEncoder();j.writeAmfxRemotingPacket(g[0]);c.xmlData=j.getBody()}Ext.Ajax.request(c)},queueTransaction:function(c){var b=this,a=false;if(c.getForm()){b.sendFormRequest(c);return}b.callBuffer.push(c);if(a){if(!b.callTask){b.callTask=Ext.create("Ext.util.DelayedTask",b.combineAndSend,b)}b.callTask.delay(Ext.isNumber(a)?a:10)}else{b.combineAndSend()}},combineAndSend:function(){var a=this.callBuffer,b=a.length;if(b>0){this.sendRequest(b==1?a[0]:a);this.callBuffer=[]}},createEvents:function(c){var d=null,g=[],k=[],a,f=0,h,b;try{if(this.getBinary()){b=new Ext.data.amf.Packet();d=b.decode(c.responseBytes)}else{b=new Ext.data.amf.XmlDecoder();d=b.readAmfxMessage(c.responseText)}}catch(j){a=new Ext.direct.ExceptionEvent({data:j,xhr:c,code:Ext.direct.Manager.exceptions.PARSE,message:"Error parsing AMF response: \n\n "+d});return[a]}if(this.getBinary()){for(f=0;f<d.getMessages().length;f++){k.push(this.createEvent(d.getMessages()[f]))}}else{k.push(this.createEvent(d))}return k},createEvent:function(c){var b=c.targetURI.split("/"),g,e,f,a,d=this;if(d.getBinary()){g=b[1];a=2}else{g=Ext.data.amf.XmlDecoder.decodeTidFromFlexUID(c.message.correlationId);a=1}if(b[a]=="onStatus"){f={tid:g,data:(d.getBinary()?c.body:c.message),code:(d.getBinary()?c.body.code:c.message.faultCode),message:(d.getBinary()?c.body.message:c.message.faultString)};e=Ext.create("direct.exception",f)}else{if(b[a]=="onResult"){f={tid:g,data:(d.getBinary()?c.body:c.message),result:(d.getBinary()?c.body:c.message.body)};e=Ext.create("direct.rpc",f)}else{}}return e}});